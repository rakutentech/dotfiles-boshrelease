#!/usr/bin/env bash
export PATH="$HOME/bin:$PATH"

# Add packages binaries to path
for pkg_bin in $(ls -d /var/vcap/packages/*/bin); do
  export PATH="$PATH:$pkg_bin"
done
unset pkg_bin

# PS1
my_env="<%= spec.deployment %>"
my_role="<%= name %>/<%= index %>"
my_ip="<%= spec.networks.to_h.values.first.ip %>"
light_red='\033[01;31m'
light_blue='\033[01;34m'
white='\033[00m'
PS1="\[${light_red}\](env=${my_env},role=${my_role},ip=${my_ip})\u\[${white}\]:\[${light_blue}\]\w\[${white}\]\n\\$ "
unset my_env my_role my_ip light_red light_blue white

# Symbol link safely
slink () {
  # if source exist
  if [[ -e $1 ]]; then
    # if symbol link doesnot exist
    if ! [[ -e $2 || -h $2 ]]; then
      ln -s $1 $2
    fi
  fi
}
slink /var/vcap/                $HOME/vcap
slink /var/vcap/packages/       $HOME/pkg
slink /var/vcap/jobs/           $HOME/jobs
slink /var/vcap/sys/log/        $HOME/log
slink /var/vcap/monit/monit.log $HOME/monit.log

# Customized completions
# Run completion if exist
compl () {
  if [[ -e $1 ]]; then
    . $1
  fi
}
compl $HOME/.wwsh.complete
compl $HOME/.monit.complete

# Warden containers
slink /var/vcap/data/warden/depot/ $HOME/depot
# Link warden containers to /root/apps
if [[ -e /var/vcap/data/warden/depot/ && -x /root/bin/link_apps ]]; then
  /var/vcap/bosh/bin/ruby /root/bin/link_apps
fi

# aliases
alias sms="monit summary"
alias m="monit"

# RTB
echo "cd $HOME"
cd $HOME
